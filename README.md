# JPA自动工作点寻找与优化系统

## 概述

本系统用于约瑟夫森参量放大器（Josephson Parametric Amplifier, JPA）的自动化测试与优化。系统能够自动寻找最优工作点，测量关键性能参数，并生成标准化测试报告。

## 主要功能

### 🎯 自动优化
- **直流偏置优化**: 自动寻找最优直流偏置点，最大化信噪比
- **微波泵浦优化**: 优化泵浦频率和功率，实现最佳放大效果
- **多参数协同优化**: 使用差分进化算法同时优化三个关键参数

### 📊 性能测试
- **增益测量**: 测量S21传输增益，评估放大器性能
- **带宽测试**: 确定有效工作频率范围
- **动态范围**: 测量1dB压缩点，评估线性工作范围
- **信噪比分析**: 通过统计分析评估测量精度

### 📈 可视化分析
- **偏置扫描图**: 直观显示SNR与偏置的关系
- **增益曲线**: 显示频率响应特性
- **优化过程**: 实时监控优化进展
- **电路图生成**: 自动生成测试配置示意图

### 📋 报告生成
- **LaTeX报告**: 自动生成专业测试报告
- **性能参数**: 提取关键指标（增益、带宽、动态范围）
- **图表导出**: 高质量矢量图表

## 系统架构

```
JPA测试系统
├── 设备控制层
│   ├── 网络分析仪 (VNA)
│   ├── 直流源 (DC Source)
│   └── 微波源 (MW Source)
├── 测量控制层
│   ├── Quark服务器
│   └── 设备通信接口
├── 数据处理层
│   ├── 信号处理
│   ├── 统计分析
│   └── 优化算法
└── 可视化层
    ├── 实时监控
    ├── 结果展示
    └── 报告生成
```

## 设备要求

### 必需设备
- **稀释制冷机**: 提供10mK极低温环境
- **网络分析仪**: 测量S参数（推荐Ceyear 3674E或同等性能）
- **微波源**: 产生泵浦信号（推荐Keysight N5183B或同等性能）
- **直流源**: 提供偏置电压（推荐Rigol DG1062Z或同等性能）

### 测试线路
- **输入线**: 包含适当的衰减器和低通滤波器
- **输出线**: 配置低噪声放大器链
- **泵浦线**: 独立的微波注入线路
- **隔离和滤波**: 确保信号质量和设备保护

## 软件依赖

### Python环境
```python
python >= 3.8
numpy >= 1.20
matplotlib >= 3.3
scipy >= 1.7
tqdm >= 4.60
```

### 专用库
```python
quark-app          # 设备控制
qulab              # 量子实验工具
nevergrad          # 优化算法
```

## 快速开始

1. **环境准备**
   ```bash
   # 克隆仓库
   git clone <repository-url>
   cd JPA_autoOP
   
   # 安装依赖
   pip install -r requirements.txt
   ```

2. **配置设备**
   - 修改`JPA_var_config`中的设备通道和参数
   - 确认测试线路连接正确
   - 启动Quark服务器

3. **运行测试**
   - 打开`JPA_NA_OPT_TEX_annotated.ipynb`
   - 按顺序执行各个cell
   - 监控优化过程和结果

详细使用说明请参考[快速开始指南](QUICKSTART.md)。

## 配置说明

### 主要配置参数

| 参数类别 | 主要参数 | 说明 |
|---------|---------|------|
| 设备信息 | `jpa_name` | JPA器件标识 |
| 线路配置 | `wiring.att` | 各平台衰减器设置 |
| 优化参数 | `opt_params` | 频率、功率、偏置的优化范围 |
| 测量设置 | `lost_setting` | 网分参数和重复次数 |
| 损失函数 | `lost_function` | 优化目标定义 |

### 自定义优化目标

系统使用加权SNR作为优化目标：
```python
# 频率权重函数示例
'func': lambda x: np.piecewise(x, [(6.5e9<=x)*(x<=7.5e9)], [1, 0])
```

可根据实际需求修改权重函数，重点优化特定频率范围。

## 测试流程

### 1. 预备阶段
- [x] 设备连接和初始化
- [x] 参数配置检查
- [x] 测试线路验证

### 2. 偏置扫描
- [x] 关闭泵浦，扫描直流偏置
- [x] 测量SNR vs 偏置关系
- [x] 识别最优空载工作点

### 3. 工作点优化
- [x] 多参数协同优化
- [x] 实时监控优化进展
- [x] 收敛判断和结果验证

### 4. 性能评估
- [x] 增益特性测量
- [x] 带宽确定
- [x] 动态范围测试
- [x] 报告生成

## 输出结果

### 测试数据
- `优化参数`: 最优微波频率、功率、直流偏置
- `性能指标`: 增益、带宽、动态范围、工作频率范围
- `测量数据`: 原始S参数数据和统计分析结果

### 图表文件
- `偏置扫描图`: SNR vs 偏置关系
- `增益特性图`: 频率响应曲线
- `动态范围图`: 功率依赖特性
- `电路示意图`: 测试配置图

### 测试报告
- `LaTeX源文件`: 专业格式报告
- `PDF报告`: 最终测试报告
- `性能总结`: 关键参数汇总

## 故障排除

### 常见问题

**Q: 优化过程收敛缓慢或不收敛**
- 检查优化范围设置是否合理
- 适当增加测量重复次数提高SNR
- 调整优化算法参数

**Q: 测量数据噪声过大**
- 检查测试线路的屏蔽和滤波
- 降低网分带宽提高测量精度
- 增加等待时间确保设备稳定

**Q: 设备通信错误**
- 确认Quark服务器连接正常
- 检查设备通道名称配置
- 验证设备IP地址和端口

### 性能优化建议

1. **测量精度优化**
   - 使用较小的网分带宽
   - 增加重复测量次数
   - 确保充分的热化时间

2. **优化效率提升**
   - 根据预期结果缩小搜索范围
   - 使用并行测量减少总时间
   - 优化设备设置减少等待时间

## 贡献指南

欢迎提交问题报告、功能建议或代码贡献：

1. Fork本仓库
2. 创建功能分支
3. 提交改动
4. 发起Pull Request

## 许可证

本项目采用MIT许可证，详见[LICENSE](LICENSE)文件。

## 联系方式

- **项目维护**: [维护者信息]
- **技术支持**: [support@example.com]
- **问题报告**: [GitHub Issues]

---

*最后更新: 2024年12月* 